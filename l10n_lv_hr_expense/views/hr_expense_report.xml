<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="hr_expense">
    <t t-call="report.html_container">
        <t t-set="e_groups" t-value="expense_groups(data and data['form'] or {})"/>
        <t t-foreach="e_groups" t-as="g">
            <t>
                <div class="page">
                    <style type="text/css">
                        div.title {
                            font-size: 16px;
                            text-align: center;
                            vertical-align: middle;
                            margin-top: 20px; 
                            margin-bottom: 20px;
                            font-weight: bold;
                        }
                        div.dates {
                            text-align: center;
                        }
                        table.list_table th {
                            border: 1px solid black;
                            font-weight: normal;
                            text-align: center;
                            vertical-align: middle;
                        }
                        table.list_table td, th {
                            padding-top: 2px;
                            padding-bottom: 2px;
                            padding-left: 4px;
                            padding-right: 4px;
                        }
                        table.signatures td {
                            padding-top: 6px;
                            padding-bottom: 6px;
                            padding-left: 4px;
                            padding-right: 4px;
                        }
                    </style>
                    <div>
                        <span>Name Surname:</span>
                        <span style="font-weight: bold;" t-esc="g['employee'] and g['employee'].name or ''"/>
                    </div>
                    <div t-if="g['employee'] and g['employee'].identification_id">
                        <span>Identification No:</span>
                        <span t-esc="g['employee'].identification_id"/>
                    </div>
                    <div t-if="g['employee'] and g['employee'].department_id">
                        <span>Department:</span>
                        <span t-esc="g['employee'].department_id.name or ''"/>
                    </div>
                    <div t-if="g['employee'] and g['employee'].bank_account_id">
                        <span>Bank Account:</span>
                        <span t-esc="g['employee'].bank_account_id.acc_number or ''"/>
                    </div>
                    <div t-if="g['currency']">
                        <span>Currency:</span>
                        <span t-esc="g['currency'].name or ''"/>
                    </div>
                    <div class="title">
                        <span>EXPENSES</span>
                    </div>
                    <t t-set="date_dict" t-value="dates(data and data['form'] or {})"/>
                    <div class="dates">
                        <span t-esc="date_dict['date_from'] and formatLang(date_dict['date_from'], date=True) or ''"/>
                        <span t-esc="date_dict['date_from'] and date_dict['date_to'] and '-' or ''"/>
                        <span t-esc="date_dict['date_to'] and formatLang(date_dict['date_to'], date=True) or ''"/>
                    </div>
                    <br/>
                    <br/>
                    <t t-set="bm_lines" t-value="bank_move_lines(data and data['form'])"/>
                    <div>
                        <span>Received:</span>
                        <span t-esc="((not bm_lines) and formatLang(0.0)) or ''"/>
                    </div>
                    <table class="list_table" width="100%" t-if="bm_lines">
                        <tr>
        		            <th width="10%">Doc. No</th>
        		            <th width="15%">Journal Entry No</th>
        		            <th width="11%">Doc. Date</th>
        		            <th width="40%">Justification</th>
        		            <th width="10%">Account</th>
        		            <th width="14%">Amount</th>
                        </tr>
                        <t t-set="total_received" t-value="0.0"></t>
                        <tr t-foreach="bm_lines" t-as="move_line">
                            <td>
                                <span t-esc="move_line.statement_id.name or ''"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="move_line.move_id.name or ''"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="formatLang(move_line.date, date=True)"/>
                            </td>
                            <td>
                                <span t-esc="move_line.name"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="move_line.account_id.code"/>
                            </td>
                            <td style="text-align: right;">
                                <span t-esc="formatLang(move_line.credit)"/>
                            </td>
                            <t t-set="total_received" t-value="total_received + move_line.credit"></t>
                        </tr>
                        <tr>
                            <td colspan="4"/>
                            <td style="border-top: 1px solid black; font-weight: bold;">
                                <span>Total:</span>
                            </td>
                            <td style="border-top: 1px solid black; font-weight: bold; text-align:right">
                                <span t-esc="formatLang(total_received)"/>
                            </td>
                        </tr>
                    </table>
                    <br/>
                    <div>
                        <span>Spent:</span>
                        <span t-esc="((not g['exp_move_lines']) and formatLang(0.0)) or ''"/>
                    </div>
                    <table class="list_table" width="100%" t-if="g['exp_move_lines']">
                        <tr>
        		            <th width="10%">Doc. No</th>
        		            <th width="15%">Journal Entry No</th>
        		            <th width="11%">Doc. Date</th>
        		            <th width="40%">Justification</th>
        		            <th width="10%">Account</th>
        		            <th width="14%">Amount</th>
                        </tr>
                        <t t-set="total_spent" t-value="0.0"></t>
                        <tr t-foreach="g['exp_move_lines']" t-as="line">
                            <td>
                                <span t-esc="line['doc_no'] or ''"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="line['journ_entr_no'] or ''"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="line['doc_date'] and formatLang(line['doc_date'], date=True) or ''"/>
                            </td>
                            <td>
                                <span t-esc="line['partner'] and line['partner'].name or ''"/><span t-if="line['partner']">, </span>
                                <span t-if="line['partner'] and line['partner'].vat">TIN</span>
                                <span t-esc="line['partner'] and line['partner'].vat or ''"/><span t-if="line['partner'] and line['partner'].vat">, </span>
                                <span t-esc="line['name']"/>
                            </td>
                            <td style="text-align: center;">
                                <span t-esc="line['account'].code"/>
                            </td>
                            <td style="text-align: right;">
                                <span t-esc="formatLang(line['debit'])"/>
                            </td>
                            <t t-set="total_spent" t-value="total_spent + line['debit']"></t>
                        </tr>
                        <tr>
                            <td colspan="4"/>
                            <td style="border-top: 1px solid black; font-weight: bold;">
                                <span>Total:</span>
                            </td>
                            <td style="border-top: 1px solid black; font-weight: bold; text-align:right;">
                                <span t-esc="formatLang(total_spent)"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3"/>
                            <td colspan="3">
                                <t t-set="cur" t-value="g['currency']"/>
                                <span t-esc="total_spent" t-esc-options='{"widget": "verbose", "display_currency": "cur"}'/>
                            </td>
                        </tr>
                    </table>
                    <br/>
                    <table width="100%" class="signatures">
                        <tr>
                            <td width="70%" style="text-align: right; vertical-align: middle;">
                                <span>Expense Person:</span>
                            </td>
                            <td width="30%" style="border-bottom: 1px solid black; color: white;">...</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; vertical-align: middle;">
                                <span>Accountant:</span>
                            </td>
                            <td style="border-bottom: 1px solid black; color: white;">...</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; vertical-align: middle;">
                                <span>Manager:</span>
                            </td>
                            <td style="border-bottom: 1px solid black; color: white;">...</td>
                        </tr>
                    </table>
                </div>
            </t>
        </t>
    </t>
</template>

<report 
    id="action_report_hr_expense_l10n_lv"
    model="hr.expense"
    string="HR Expense"
    report_type="qweb-pdf"
    name="l10n_lv_hr_expense.hr_expense"
    file="l10n_lv_hr_expense.hr_expense"
    />

<record id="report_paperformat_hr_expense_portrait" model="report.paperformat">
    <field name="name">HR Expense Portrait</field>
    <field name="margin_top" eval="10"/>
    <field name="margin_left" eval="20"/>
    <field name="margin_bottom" eval="10"/>
    <field name="margin_right" eval="10"/>
    <field name="format">A4</field>
    <field name="orientation">Portrait</field>
</record>

<record id="l10n_lv_hr_expense.action_report_hr_expense_l10n_lv" model="ir.actions.report.xml">
    <field name="paperformat_id" ref="l10n_lv_hr_expense.report_paperformat_hr_expense_portrait"/>
</record>

</odoo>